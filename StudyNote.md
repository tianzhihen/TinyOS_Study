#8-25  TinyOS 学习笔记
##同步和异步

###关键词：async
1.使用“async”修饰的命令函数或者事件函数都是异步的，可以抢占当前的执行过程，异步函数调用的命令和触发的事件都应该是异步的

2.所有中断处理程序都是异步的，因此不能调用同步函数。在中断处理程序中，执行同步函数的唯一方法就是发布任务。任务的发布是一个异步操作。

3.使用异步代码容易导致数据的冲突竞争等，在实际编写时尽量使用同步代码，当且仅当该代码的时间要求非常严格时，或者调用该代码片段的的上级代码对时间要求比较严格时，才建议使用异步代码
##原子性代码
1.nesC提供了atomic语句用于保护一小段代码不被抢占
**但是这不意味着atomic语句块不会被抢占，如果两个atomic语句块使用不同的变量，则可以相互抢占**

如：

`command void function1()
{
  atomic
    {
     a++;
     b=a+1;
    }
}   `

`command void function2()
{
  atomic
    {
      c++;
      d=c++;
    }
}  `

**如以上例子所示，function1可以抢占function2不可冒犯的原子性。但是function1不会抢占自身。即包含相同变量的的atomic代码块不能相互抢占执行**
2.如果是异步函数访问该变量，那么这个变量必须得到atomic保护。
3.虽然为了避免数据竞争冲突，可以随便布置atomic代码块，但是：atomic会浪费cpu资源;atomic代码块应该尽量短，使得对中断的延迟少，有利于提高系统的并发性。
4.atomic通常用于转换一个组件的状态变量，如果异步函数要修改一个状态变量，那么必须使用atomic代码块来保证状态转换的原子性。
##

